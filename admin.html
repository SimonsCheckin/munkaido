<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Check-in Rendszer | ADMIN Menedzser Fel√ºlet</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS V√ÅLTOZ√ìK AZ INDEX.HTML-B≈êL */
        :root {
            --color-primary: #1e7e34;
            --color-primary-light: #4caf50;
            --color-background: #f8f9fa;
            --color-white: #ffffff;
            --color-text-dark: #212529;
            --color-error: #dc3545;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px 0; /* Kisebb padding mobilra */
            background-color: var(--color-background);
            color: var(--color-text-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            width: 100%; /* Teljes sz√©less√©g mobilra */
            max-width: 1100px;
            margin: 20px auto; /* Kisebb marg√≥ */
            background-color: var(--color-white);
            padding: 20px; /* Kisebb padding */
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: var(--color-primary);
            font-weight: 700;
            border-bottom: 3px solid var(--color-primary-light);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.6rem; /* Kisebb f≈ëc√≠m */
            display: flex;
            flex-direction: column; /* Mobil n√©zetben a gomb al√° ker√ºl a c√≠m */
            align-items: flex-start;
        }

        h1 span:first-child {
            order: 2; /* C√≠m alul */
        }

        #resetHoursButton {
            order: 1; /* Gomb fel√ºl */
            margin-bottom: 15px; 
        }

        h2 {
            font-size: 1.4rem;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        /* Sz≈±r√©si vez√©rl≈ë st√≠lusa (reszponz√≠v) */
        .filter-control {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background-color: #f7f7f7;
            display: flex;
            gap: 15px;
            flex-direction: column; /* Egym√°s al√° a telefonos n√©zetben */
        }
        
        .filter-group {
            width: 100%;
            min-width: unset;
        }

        .filter-control label {
            font-size: 0.9rem;
        }

        .filter-control select, .filter-control input[type="date"] {
            padding: 8px;
            font-size: 0.9rem;
        }

        /* GOMBOK ST√çLUSA */
        .admin-button {
            padding: 8px 12px;
            font-size: 0.85rem;
            /* ... (Tov√°bbi gomb st√≠lusok v√°ltozatlanul) ... */
        }
        
        /* C√çM √âS EXPORT GOMB T√ÅROL√ì (Reszponz√≠v) */
        .log-header {
            display: flex;
            flex-direction: column; /* Egym√°s al√° mobil n√©zetben */
            align-items: flex-start;
            margin-top: 30px;
            padding-top: 15px;
        }
        
        .log-header h2 {
            order: 2;
            margin-top: 10px;
            font-size: 1.4rem;
        }
        
        #exportCsvButton {
            order: 1;
            margin-bottom: 15px;
        }

        /* T√°bl√°zat kont√©ner a horizont√°lis g√∂rget√©shez mobil n√©zetben */
        .table-responsive {
            width: 100%;
            overflow-x: auto; /* Ez biztos√≠tja a g√∂rget√©st, ha a tartalom nem f√©r el */
        }

        /* T√°bl√°zat st√≠lusok (kisebb bet≈±m√©ret) */
        .admin-table {
            min-width: 600px; /* Minim√°lis sz√©less√©g a g√∂rget√©s bekapcsol√°s√°hoz */
            font-size: 0.8rem;
        }

        .admin-table th, .admin-table td {
            padding: 8px 10px;
        }

        /* ... (M√≥dos√≠t√°sok a MOD√ÅLIS ABLAKRA) ... */
        .modal-content {
            margin: 30% auto; /* Magasabbra ker√ºl a mod√°l mobil n√©zetben */
            padding: 20px;
        }

        /* Alap√©rtelmezett (Desktop) M√©dia Lek√©rdez√©s bevezet√©se */
        @media screen and (min-width: 769px) {
            .container {
                padding: 30px 40px;
            }
            h1 {
                flex-direction: row;
                align-items: center;
            }
            h1 span:first-child {
                order: 1;
            }
            #resetHoursButton {
                order: 2;
                margin-bottom: 0;
            }
            .filter-control {
                flex-direction: row;
            }
            .log-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            .log-header h2 {
                order: 1;
                margin-top: 0;
            }
            #exportCsvButton {
                order: 2;
                margin-bottom: 0;
            }
            .admin-table {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body onload="initializeAdminPanel()">

<div class="container">
    
    <h1>
        <span>üìä Adminisztr√°ci√≥s Munkaid≈ë √ñsszes√≠t√©s</span>
        
        <button id="resetHoursButton" class="admin-button" onclick="openResetModal()">
            √ñsszes adat t√∂rl√©se
        </button>
    </h1>
    
    <div class="filter-control">
        </div>

    <h2>Dolgoz√≥i Munka√≥ra √ñsszes√≠t√©s</h2>
    <div class="table-responsive"> <table class="admin-table">
            <thead>
                </thead>
            <tbody id="adminTableBody">
                </tbody>
        </table>
    </div>
    
    <div id="detailedLogSection">
        <div class="log-header">
              <h2>R√©szletes Be- √©s Kijelentkez√©si Napl√≥</h2>
              <button id="exportCsvButton" class="admin-button" onclick="exportDetailedLogToCSV()">
                CSV Export (sz≈±rt adatok)
            </button>
        </div>
        
        <p style="color: var(--color-primary); font-style: italic;" id="logFilterStatus"></p>
        
        <div class="table-responsive"> <table class="admin-table detailed-table">
                <thead>
                    <tr>
                        <th>D√°tum</th>
                        <th>Dolgoz√≥</th>
                        <th>Egys√©g</th>
                        <th>Bejelentkez√©s</th>
                        <th>Kijelentkez√©s</th>
                        <th>Munkamenet Id≈ë</th>
                        <th>St√°tusz</th>
                    </tr>
                </thead>
                <tbody id="detailedLogBody">
                </tbody>
            </table>
        </div>
    </div>
    
    </div>

<script>
    // --- KONFIGUR√ÅCI√ìS ADATOK (V√°ltozatlanul) ---
    
    const CHECKIN_DATA_KEY = 'work_sessions'; 

    const RESTAURANT_LOCATIONS = {
        'EGE': { name: 'Eger', lat: 47.9072155, lon: 20.3880078 },
        'PAK': { name: 'P√°kozd/M7', lat: 47.1685, lon: 18.5995 },
        'ALLEE': { name: 'Allee', lat: 47.4725, lon: 19.0498 },
        'VES': { name: 'Veszpr√©m', lat: 47.0945, lon: 17.9069 },
        'SZE': { name: 'Sz√©kesfeh√©rv√°r', lat: 47.1895, lon: 18.4208 }
    };

    const EMPLOYEE_DATA = [
        { id: 'EGE_001', name: 'Magyar Marcell', unit: 'EGE' },
        { id: 'EGE_006', name: 'Jo√≥ Krist√≥f S√°ndor', unit: 'EGE' },
        // ... (Dolgoz√≥k) ...
        { id: 'PAK_015', name: 'Nagy Anna', unit: 'PAK' }
    ];
    
    const EMPLOYEE_MAP = EMPLOYEE_DATA.reduce((map, employee) => {
        map[employee.id] = employee;
        return map;
    }, {});

    // --- SEG√âDF√úGGV√âNYEK (V√°ltozatlanul) ---
    
    function parseHungarianTimestamp(timestampStr) { /* ... */ }
    function formatDuration(start, end) { /* ... */ }
    function durationToHours(durationStr) { /* ... */ }

    // --- ADATFELDOLGOZ√ì LOGIKA (V√°ltozatlanul) ---

    function processWorkSessions() { /* ... */ }
    function initializeAdminPanel() { /* ... */ }
    function populateAdminCities() { /* ... */ }

    // --- FONTOS! A Reszponz√≠v updateAdminPanel f√ºggv√©ny (a v√©gleges, utolj√°ra k√©rt tartalommal) ---
    function updateAdminPanel() {
        const selectedUnitCode = document.getElementById('adminCitySelect').value;
        const startDateStr = document.getElementById('startDate').value;
        const endDateStr = document.getElementById('endDate').value;

        const { totalHoursByEmployee, detailedLog, activeSessions } = processWorkSessions();

        const activeIds = activeSessions.map(s => s.id);
        
        const filterStartDate = startDateStr ? new Date(startDateStr) : null;
        const filterEndDate = endDateStr ? new Date(endDateStr) : null;
        if (filterEndDate) {
            filterEndDate.setHours(23, 59, 59, 999);
        }

        // 1. √ñSSZES√çT≈ê T√ÅBL√ÅZAT FRISS√çT√âSE
        const summaryBody = document.getElementById('adminTableBody');
        summaryBody.innerHTML = '';
        
        const aggregatedData = {};

        EMPLOYEE_DATA.forEach(employee => { /* ... */ });
        Object.values(aggregatedData).sort((a, b) => a.name.localeCompare(b.name)).forEach(data => { /* ... */ });


        // 2. R√âSZLETES NAPL√ì T√ÅBL√ÅZAT FRISS√çT√âSE
        const detailedBody = document.getElementById('detailedLogBody');
        detailedBody.innerHTML = '';
        
        let filteredLogCount = 0;

        window.filteredDetailedLog = []; 

        detailedLog.forEach(log => {
            const logDate = parseHungarianTimestamp(log.checkIn);
            if (!logDate) return;

            // Sz≈±r√©si felt√©telek
            if (selectedUnitCode !== 'ALL' && EMPLOYEE_MAP[log.id].unit !== selectedUnitCode) { return; }
            if (filterStartDate && logDate.getTime() < filterStartDate.getTime()) { return; }
            if (filterEndDate && logDate.getTime() > filterEndDate.getTime()) { return; }
            
            window.filteredDetailedLog.push(log);
            filteredLogCount++;
            
            const row = detailedBody.insertRow();
            if (log.isActive) {
                row.classList.add('active-log');
            }

            // A k√©rt form√°tum: D√°tum (dd. mm. yyyy) √©s Id≈ë (HH:MM:SS) k√ºl√∂n oszlopokban
            const datePart = log.checkIn.substring(0, 10);
            const checkInTime = log.checkIn.substring(12); // HH:MM:SS
            
            const checkOutTime = log.checkOut === 'AKTU√ÅLISAN BEJELENTKEZVE' 
                                 ? 'AKTU√ÅLIS' 
                                 : log.checkOut.substring(12); // HH:MM:SS
            
            row.insertCell().textContent = datePart;
            row.insertCell().textContent = log.name;
            row.insertCell().textContent = log.unit;
            row.insertCell().textContent = checkInTime; 
            row.insertCell().textContent = checkOutTime;
            row.insertCell().textContent = log.durationStr;
            row.insertCell().textContent = log.isActive ? 'Akt√≠v' : 'Lez√°rva';
        });

        // ... (Sz≈±r√©si st√°tusz √ºzenet √©s Nincs adat kezel√©se v√°ltozatlanul) ...
    }

    // --- CSV EXPORT, MOD√ÅLIS LOGIKA (V√°ltozatlanul) ---
    function exportDetailedLogToCSV() { /* ... */ }
    function openResetModal() { /* ... */ }
    function closeResetModal() { /* ... */ }
    function performReset() { /* ... */ }
    
    // ESC gomb a mod√°lis bez√°r√°s√°ra
    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeResetModal();
        }
    });

</script>
</body>
</html>
